<!DOCTYPE html>
<html lang="en">
  <head>
    {% include head.html %}
  </head>
  <body class="flex min-h-screen flex-col font-sans text-slate-900">
    <a
      class="sr-only focus:not-sr-only focus:absolute focus:left-6 focus:top-6 focus:rounded-full focus:bg-brand focus:px-4 focus:py-2 focus:text-white focus:shadow-lg"
      href="#main"
      >Skip to content</a
    >
    <header class="site-header" data-site-header>
      <div class="site-header__bar">
        <a class="site-header__brand" href="{{ "/" | relative_url }}">{{ site.title }}</a>
        <nav class="site-nav" aria-label="Primary" data-nav>
          <button
            class="site-nav__toggle"
            aria-expanded="false"
            aria-controls="primary-navigation"
            type="button"
            data-nav-toggle
          >
            <span class="sr-only">Toggle navigation</span>
            <span aria-hidden="true" class="site-nav__toggle-bar"></span>
            <span aria-hidden="true" class="site-nav__toggle-bar"></span>
            <span aria-hidden="true" class="site-nav__toggle-bar site-nav__toggle-bar--short"></span>
          </button>
          <div class="site-nav__overlay" data-nav-overlay></div>
          <ul id="primary-navigation" class="site-nav__list" data-nav-list>
            {% for link in site.nav_links %}
            <li class="site-nav__item">
              <a class="site-nav__link" href="{{ link.url | relative_url }}">{{ link.title }}</a>
            </li>
            {% endfor %}
          </ul>
        </nav>
      </div>
    </header>

    <main id="main" class="flex-1 pt-28 md:pt-32">
      {{ content }}
    </main>

    <footer class="border-t border-slate-200 py-12">
      <div class="mx-auto flex w-full max-w-6xl flex-col gap-8 px-6 text-sm text-slate-600 sm:text-base lg:flex-row lg:items-start lg:justify-between">
        <div class="space-y-3">
          <p class="text-lg font-semibold text-slate-900">Let’s collaborate.</p>
          <a class="inline-flex items-center gap-2 text-brand-dark hover:text-brand" href="mailto:{{ site.social.email }}">
            <span>{{ site.social.email }}</span>
          </a>
        </div>
        <div class="flex flex-1 flex-col gap-4 sm:flex-row sm:items-end sm:justify-end">
          <ul class="flex flex-wrap gap-4 text-sm font-medium text-slate-600" aria-label="Social links">
            {% if site.social.linkedin %}<li><a class="hover:text-brand" href="{{ site.social.linkedin }}">LinkedIn</a></li>{% endif %}
            {% if site.social.dribbble %}<li><a class="hover:text-brand" href="{{ site.social.dribbble }}">Dribbble</a></li>{% endif %}
            {% if site.social.github %}<li><a class="hover:text-brand" href="{{ site.social.github }}">GitHub</a></li>{% endif %}
            {% if site.social.medium %}<li><a class="hover:text-brand" href="{{ site.social.medium }}">Medium</a></li>{% endif %}
          </ul>
          <p class="text-xs text-slate-400 sm:text-right">© {{ "now" | date: "%Y" }} {{ site.title }} · Built with Jekyll.</p>
        </div>
      </div>
    </footer>

    <script>
      const gradientStops = [
        { time: 0, top: '#020024', bottom: '#090979' },
        { time: 3.5, top: '#040b29', bottom: '#1d2951' },
        { time: 6, top: '#ff8a65', bottom: '#ffd194' },
        { time: 9, top: '#87ceeb', bottom: '#f5f7fa' },
        { time: 12, top: '#56ccf2', bottom: '#2f80ed' },
        { time: 16.5, top: '#f2994a', bottom: '#f2c94c' },
        { time: 19, top: '#6a11cb', bottom: '#2575fc' },
        { time: 21.5, top: '#1b2735', bottom: '#090a27' },
        { time: 24, top: '#020024', bottom: '#090979' }
      ];

      const hexToRgb = (hex) => {
        const parsed = hex.replace('#', '');
        const bigint = parseInt(parsed, 16);
        return {
          r: (bigint >> 16) & 255,
          g: (bigint >> 8) & 255,
          b: bigint & 255
        };
      };

      const interpolateChannel = (start, end, factor) => Math.round(start + (end - start) * factor);

      const interpolateColor = (start, end, factor) => {
        const startRgb = hexToRgb(start);
        const endRgb = hexToRgb(end);
        return {
          r: interpolateChannel(startRgb.r, endRgb.r, factor),
          g: interpolateChannel(startRgb.g, endRgb.g, factor),
          b: interpolateChannel(startRgb.b, endRgb.b, factor)
        };
      };

      const rgbToString = ({ r, g, b }) => `rgb(${r}, ${g}, ${b})`;

      const mixRgb = (start, end, factor = 0.5) => ({
        r: Math.round(start.r + (end.r - start.r) * factor),
        g: Math.round(start.g + (end.g - start.g) * factor),
        b: Math.round(start.b + (end.b - start.b) * factor)
      });

      const srgbChannelToLinear = (value) => {
        const channel = value / 255;
        if (channel <= 0.04045) {
          return channel / 12.92;
        }
        return Math.pow((channel + 0.055) / 1.055, 2.4);
      };

      const getRelativeLuminance = ({ r, g, b }) =>
        0.2126 * srgbChannelToLinear(r) + 0.7152 * srgbChannelToLinear(g) + 0.0722 * srgbChannelToLinear(b);

      const applyDynamicPalette = (topColor, bottomColor) => {
        const midpoint = mixRgb(topColor, bottomColor, 0.5);
        const luminance = getRelativeLuminance(midpoint);
        const isDarkBackground = luminance < 0.55;

        const palette = isDarkBackground
          ? {
              '--dynamic-text-on-background': '#f8fafc',
              '--dynamic-text-muted': 'rgba(248, 250, 252, 0.72)',
              '--dynamic-glass-background': 'rgba(248, 250, 252, 0.78)',
              '--dynamic-glass-border': 'rgba(248, 250, 252, 0.45)',
              '--dynamic-glass-text': '#0f172a',
              '--dynamic-glass-text-muted': 'rgba(15, 23, 42, 0.72)',
              '--dynamic-control-surface': 'rgba(248, 250, 252, 0.18)',
              '--dynamic-control-surface-hover': 'rgba(248, 250, 252, 0.28)',
              '--dynamic-control-text': '#0f172a'
            }
          : {
              '--dynamic-text-on-background': '#0f172a',
              '--dynamic-text-muted': 'rgba(15, 23, 42, 0.68)',
              '--dynamic-glass-background': 'rgba(15, 23, 42, 0.58)',
              '--dynamic-glass-border': 'rgba(15, 23, 42, 0.35)',
              '--dynamic-glass-text': '#f8fafc',
              '--dynamic-glass-text-muted': 'rgba(248, 250, 252, 0.78)',
              '--dynamic-control-surface': 'rgba(15, 23, 42, 0.16)',
              '--dynamic-control-surface-hover': 'rgba(15, 23, 42, 0.26)',
              '--dynamic-control-text': '#f8fafc'
            };

        const rootElement = document.documentElement;
        Object.entries(palette).forEach(([variable, value]) => {
          rootElement.style.setProperty(variable, value);
        });
      };

      const getGradientForTime = (date) => {
        const minutes = date.getHours() * 60 + date.getMinutes();
        const currentTime = minutes / 60;
        let previousStop = gradientStops[0];
        let nextStop = gradientStops[gradientStops.length - 1];

        for (let i = 0; i < gradientStops.length - 1; i += 1) {
          const stop = gradientStops[i];
          const upcoming = gradientStops[i + 1];
          if (currentTime >= stop.time && currentTime < upcoming.time) {
            previousStop = stop;
            nextStop = upcoming;
            break;
          }
        }

        const span = nextStop.time - previousStop.time || 1;
        const factor = Math.min(Math.max((currentTime - previousStop.time) / span, 0), 1);
        const top = interpolateColor(previousStop.top, nextStop.top, factor);
        const bottom = interpolateColor(previousStop.bottom, nextStop.bottom, factor);
        return {
          gradient: `linear-gradient(180deg, ${rgbToString(top)} 0%, ${rgbToString(bottom)} 100%)`,
          top,
          bottom
        };
      };

      const applyGradient = () => {
        const { gradient, top, bottom } = getGradientForTime(new Date());
        document.documentElement.style.setProperty('--sky-gradient', gradient);
        document.body.style.setProperty('--sky-gradient', gradient);
        applyDynamicPalette(top, bottom);
      };

      applyGradient();
      setInterval(applyGradient, 60000);

      const header = document.querySelector('[data-site-header]');
      const nav = document.querySelector('[data-nav]');
      const navToggle = nav?.querySelector('[data-nav-toggle]');
      const navOverlay = nav?.querySelector('[data-nav-overlay]');
      const navLinks = nav?.querySelectorAll('.site-nav__link');
      const root = document.documentElement;
      const setMobileOpen = (state) => {
        if (!navToggle) return;
        nav?.setAttribute('data-mobile-open', state.toString());
        navToggle.setAttribute('aria-expanded', state.toString());
        root.classList.toggle('has-mobile-nav', state);
      };

      const setNavCollapsed = (state) => {
        nav?.setAttribute('data-collapsed', state.toString());
        header?.setAttribute('data-collapsed', state.toString());
        if (state) {
          setMobileOpen(false);
        }
      };

      let lastScrollY = window.scrollY;
      let scrollTicking = false;

      const handleScroll = () => {
        const currentY = window.scrollY;
        const isDesktop = window.matchMedia('(min-width: 768px)').matches;

        if (!isDesktop) {
          setNavCollapsed(true);
          lastScrollY = currentY;
          return;
        }

        if (currentY > lastScrollY + 12 && currentY > 120) {
          setNavCollapsed(true);
        } else if (currentY < lastScrollY - 12 || currentY <= 80) {
          setNavCollapsed(false);
        }

        lastScrollY = currentY;
      };

      window.addEventListener('scroll', () => {
        if (!scrollTicking) {
          window.requestAnimationFrame(() => {
            handleScroll();
            scrollTicking = false;
          });
          scrollTicking = true;
        }
      });

      const handleResize = () => {
        const isDesktop = window.matchMedia('(min-width: 768px)').matches;
        if (isDesktop) {
          if (window.scrollY <= 80) {
            setNavCollapsed(false);
          } else {
            handleScroll();
          }
        } else {
          setNavCollapsed(true);
        }
        setMobileOpen(false);
      };

      window.addEventListener('resize', handleResize);
      handleResize();

      navToggle?.addEventListener('click', () => {
        const isDesktop = window.matchMedia('(min-width: 768px)').matches;
        if (isDesktop) {
          setNavCollapsed(false);
          return;
        }
        const expanded = nav?.getAttribute('data-mobile-open') === 'true';
        setMobileOpen(!expanded);
      });

      navOverlay?.addEventListener('click', () => {
        setMobileOpen(false);
      });

      navLinks?.forEach((link) => {
        link.addEventListener('click', () => {
          if (!window.matchMedia('(min-width: 768px)').matches) {
            setMobileOpen(false);
          }
        });
      });

      window.addEventListener('keydown', (event) => {
        if (event.key === 'Escape' && nav?.getAttribute('data-mobile-open') === 'true') {
          setMobileOpen(false);
        }
      });
    </script>
  </body>
</html>
